<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Soblend Dashboard</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Product+Sans&display=swap");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Product Sans", sans-serif;
                background: #ffffff;
                color: #000000;
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: #fff;
                border: 1px solid #ddd;
                border-radius: 0;
                padding: 30px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            }

            h1 {
                display: flex;
                align-items: center;
                gap: 10px;
                color: #000;
                margin-bottom: 30px;
                font-size: 2.2em;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: #f9f9f9;
                color: #000;
                padding: 25px;
                border: 1px solid #ddd;
                border-radius: 0;
                transition: background 0.2s ease;
            }

            .stat-card:hover {
                background: #f0f0f0;
            }

            .stat-card h3 {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 1em;
                margin-bottom: 10px;
                color: #555;
            }

            .stat-card .value {
                font-size: 2.3em;
                font-weight: bold;
            }

            .section {
                margin-top: 30px;
            }

            .section h2 {
                display: flex;
                align-items: center;
                gap: 8px;
                color: #000;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 2px solid #000;
                font-size: 1.3em;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 15px;
            }

            th,
            td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            th {
                background: #000;
                color: white;
                font-weight: 600;
            }

            tr:hover {
                background: #f5f5f5;
            }

            .btn {
                padding: 8px 16px;
                border: none;
                border-radius: 0;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s;
            }

            .btn-danger {
                background: #e74c3c;
                color: white;
            }

            .btn-success {
                background: #2ecc71;
                color: white;
            }

            .btn:hover {
                opacity: 0.85;
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: #000;
                font-size: 1.2em;
            }

            svg {
                width: 20px;
                height: 20px;
                fill: #000;
            }

            .icon-white {
                fill: white;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path
                        d="M3 13h2v-2H3v2zm4 0h2v-2H7v2zm4 0h2v-2h-2v2zm4 0h2v-2h-2v2zm4 0h2v-2h-2v2zM3 17h18v2H3v-2zM3 9h18V7H3v2z"
                    />
                </svg>
                Soblend Dashboard
            </h1>

            <div id="loading" class="loading">Cargando datos...</div>

            <div id="dashboard" style="display: none">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5C23 14.17 18.33 13 16 13z"
                                />
                            </svg>
                            Usuarios Totales
                        </h3>
                        <div class="value" id="totalUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M4 6H2v14a2 2 0 002 2h14v-2H4V6zm16-4H8a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"
                                />
                            </svg>
                            Grupos
                        </h3>
                        <div class="value" id="totalGroups">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M20 2H4a2 2 0 00-2 2v16l4-4h14a2 2 0 002-2V4a2 2 0 00-2-2z"
                                />
                            </svg>
                            Chats
                        </h3>
                        <div class="value" id="totalChats">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M12 20c4.41 0 8-3.59 8-8s-3.59-8-8-8-8 3.59-8 8 3.59 8 8 8zM11 6h2v6l4.25 2.52-.77 1.28L11 13V6z"
                                />
                            </svg>
                            Uptime
                        </h3>
                        <div class="value" id="uptime">0h</div>
                    </div>
                </div>

                <div class="section">
                    <h2>
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 14.5h-2V17h2v-.5zm0-2.5h-2V7h2v7z"
                            />
                        </svg>
                        Top Usuarios
                    </h2>
                    <table id="topUsersTable">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Nivel</th>
                                <th>Puntos</th>
                                <th>Mensajes</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="section">
                    <h2>
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M19.43 12.98l1.77-1.77-1.41-1.41-1.77 1.77a7.932 7.932 0 00-1.85-1.07l.28-1.97H8.55l.28 1.97a7.932 7.932 0 00-1.85 1.07L5.21 9.8l-1.41 1.41 1.77 1.77c-.16.59-.24 1.21-.24 1.85 0 .64.08 1.26.24 1.85l-1.77 1.77 1.41 1.41 1.77-1.77c.59.16 1.21.24 1.85.24s1.26-.08 1.85-.24l1.77 1.77 1.41-1.41-1.77-1.77c.16-.59.24-1.21.24-1.85 0-.64-.08-1.26-.24-1.85z"
                            />
                        </svg>
                        Sistema
                    </h2>
                    <div id="systemStats"></div>
                </div>
            </div>
        </div>

        <script>
            const API_TOKEN = "demo-secret-token";

            async function fetchAPI(endpoint) {
                const response = await fetch(`/api${endpoint}`, {
                    headers: { Authorization: `Bearer ${API_TOKEN}` },
                });
                return response.json();
            }

            async function loadDashboard() {
                try {
                    const stats = await fetchAPI("/stats");
                    const topUsers = await fetchAPI("/users/top?limit=10");

                    document.getElementById("totalUsers").textContent =
                        stats.users.total;
                    document.getElementById("totalGroups").textContent =
                        stats.groups.total;
                    document.getElementById("totalChats").textContent =
                        stats.chats.total;

                    const uptimeHours = Math.floor(
                        stats.system.uptime / 3600000,
                    );
                    document.getElementById("uptime").textContent =
                        `${uptimeHours}h`;

                    const tbody = document.querySelector(
                        "#topUsersTable tbody",
                    );
                    tbody.innerHTML = topUsers
                        .map(
                            (user) => `
                    <tr>
                        <td>${user.name || user.jid}</td>
                        <td>${user.level || 0}</td>
                        <td>${user.points || 0}</td>
                        <td>${user.messageCount || 0}</td>
                    </tr>
                `,
                        )
                        .join("");

                    document.getElementById("loading").style.display = "none";
                    document.getElementById("dashboard").style.display =
                        "block";
                } catch (error) {
                    console.error("Error loading dashboard:", error);
                    document.getElementById("loading").textContent =
                        "Error al cargar datos";
                }
            }

            loadDashboard();
            setInterval(loadDashboard, 30000);
        </script>
    </body>
</html>
